<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第5章 补充 | 精通比特币SV</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script data-ad-client="ca-pub-2028497727822047" async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="改写自精通比特币第二版，原版权属于原作者">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/MasterBitcoinSV/assets/css/0.styles.ccf6f871.css" as="style"><link rel="preload" href="/MasterBitcoinSV/assets/js/app.1cc508ac.js" as="script"><link rel="preload" href="/MasterBitcoinSV/assets/js/3.37227c69.js" as="script"><link rel="preload" href="/MasterBitcoinSV/assets/js/26.7276f704.js" as="script"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/10.466ab898.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/11.49136d61.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/12.2e334333.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/13.404c7e9f.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/14.15b90a1f.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/15.4d492ff6.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/16.a25fc06c.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/17.281cda1b.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/18.cd5a8e96.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/19.3d366222.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/20.4da782d1.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/21.7a50fc73.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/22.d8c8068a.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/23.b4051a1e.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/24.0b54f372.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/25.77c62c7f.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/27.8194ac23.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/28.906be128.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/29.487d6557.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/30.e59148dd.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/31.65374195.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/32.1b30d987.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/33.9535960e.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/34.a8d8210d.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/35.bf75033e.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/36.e9dca757.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/37.cf19f129.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/38.d0faccfb.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/39.4ad08d8f.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/4.2f8e84ac.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/40.f102d9f9.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/41.88ac9ca6.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/42.74ff6562.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/43.1c5b3b4c.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/44.84629ca2.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/45.8cb72f7e.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/46.509ca026.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/5.0804d6ab.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/6.411afdf3.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/7.751e9ad2.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/8.f7425502.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/9.e4e96770.js"><link rel="prefetch" href="/MasterBitcoinSV/assets/js/vendors~flowchart.5985ff59.js">
    <link rel="stylesheet" href="/MasterBitcoinSV/assets/css/0.styles.ccf6f871.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/MasterBitcoinSV/" class="home-link router-link-active"><!----> <span class="site-name">精通比特币SV</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/baryon/MasterBitcoinSV" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/baryon/MasterBitcoinSV" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/MasterBitcoinSV/" aria-current="page" class="sidebar-link">精通比特币SV</a></li><li><a href="/MasterBitcoinSV/glossary.html" class="sidebar-link">词汇表</a></li><li><a href="/MasterBitcoinSV/ch01.html" class="sidebar-link">第1章 介绍</a></li><li><a href="/MasterBitcoinSV/ch02.html" class="sidebar-link">第2章 比特币工作原理</a></li><li><a href="/MasterBitcoinSV/ch03.html" class="sidebar-link">第3章 Bitcoin SV</a></li><li><a href="/MasterBitcoinSV/ch04.html" class="sidebar-link">第4章 密钥和地址</a></li><li><a href="/MasterBitcoinSV/ch05.html" class="sidebar-link">第5章 钱包</a></li><li><a href="/MasterBitcoinSV/ch05a.html" aria-current="page" class="active sidebar-link">第5章 补充</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/MasterBitcoinSV/ch05a.html#基于-bip-32-和-bip-39-规范生成-hd-钱包-分层确定性钱包" class="sidebar-link">基于 BIP-32 和 BIP-39 规范生成 HD 钱包（分层确定性钱包）</a></li><li class="sidebar-sub-header"><a href="/MasterBitcoinSV/ch05a.html#关于扩展密钥-extended-key" class="sidebar-link">关于扩展密钥(extended key)</a></li><li class="sidebar-sub-header"><a href="/MasterBitcoinSV/ch05a.html#硬化衍生子密钥又是什么鬼" class="sidebar-link">硬化衍生子密钥又是什么鬼？</a></li><li class="sidebar-sub-header"><a href="/MasterBitcoinSV/ch05a.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/MasterBitcoinSV/ch06.html" class="sidebar-link">第6章 交易</a></li><li><a href="/MasterBitcoinSV/ch06a.html" class="sidebar-link">第6章 补充</a></li><li><a href="/MasterBitcoinSV/ch07.html" class="sidebar-link">第7章 高级交易和脚本</a></li><li><a href="/MasterBitcoinSV/ch08.html" class="sidebar-link">第8章 比特币网络</a></li><li><a href="/MasterBitcoinSV/ch09.html" class="sidebar-link">第9章 区块链</a></li><li><a href="/MasterBitcoinSV/ch10.html" class="sidebar-link">第10章 挖矿和共识</a></li><li><a href="/MasterBitcoinSV/ch11.html" class="sidebar-link">第11章 比特币安全</a></li><li><a href="/MasterBitcoinSV/ch12.html" class="sidebar-link">第12章 区块链应用</a></li><li><a href="/MasterBitcoinSV/appdx-bitcoinwhitepaper.html" class="sidebar-link">附录A-1、比特币白皮书：一种点对点的电子现金系统</a></li><li><a href="/MasterBitcoinSV/bitcoin-whitepaper-cn.html" class="sidebar-link">附录A-2、比特币白皮书（李笑来中英文对照版）</a></li><li><a href="/MasterBitcoinSV/appdx-scriptops.html" class="sidebar-link">附录B、交易脚本语言操作符，常量和符号</a></li><li><a href="/MasterBitcoinSV/appdx-bips.html" class="sidebar-link">附录C、比特币改进提案（BIPs）</a></li><li><a href="/MasterBitcoinSV/appdx-bitcore.html" class="sidebar-link">附录D Bitcore</a></li><li><a href="/MasterBitcoinSV/appdx-pycoin.html" class="sidebar-link">附录E、pycoin</a></li><li><a href="/MasterBitcoinSV/appdx-bx.html" class="sidebar-link">附录F、比特币浏览器命令</a></li><li><a href="/MasterBitcoinSV/second_edition_changes.html" class="sidebar-link">第二版更新内容</a></li><li><a href="/MasterBitcoinSV/README-ytm2nd.html" class="sidebar-link">精通比特币第二版中文翻译开篇</a></li><li><a href="/MasterBitcoinSV/preface.html" class="sidebar-link">原版序言</a></li><li><a href="/MasterBitcoinSV/cn-preface.html" class="sidebar-link">中文版序言</a></li><li><a href="/MasterBitcoinSV/trans-preface.html" class="sidebar-link">译者序</a></li><li><a href="/MasterBitcoinSV/SUMMARY.html" class="sidebar-link">总结</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第5章-补充"><a href="#第5章-补充" class="header-anchor">#</a> 第5章 补充</h1> <h2 id="基于-bip-32-和-bip-39-规范生成-hd-钱包-分层确定性钱包"><a href="#基于-bip-32-和-bip-39-规范生成-hd-钱包-分层确定性钱包" class="header-anchor">#</a> 基于 BIP-32 和 BIP-39 规范生成 HD 钱包（分层确定性钱包）</h2> <p><a href="https://stevenocean.github.io/2018/09/23/generate-hd-wallet-by-bip39.html" target="_blank" rel="noopener noreferrer">基于 BIP-32 和 BIP-39 规范生成 HD 钱包（分层确定性钱包） | 未来边缘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="关于-bitcoin-的钱包"><a href="#关于-bitcoin-的钱包" class="header-anchor">#</a> 关于 Bitcoin 的钱包</h3> <p>在 Bitcoin 中有两种主要类型的钱包，分别为：</p> <ol><li><strong>非确定性钱包（Nodeterministic Wallet）</strong>：该钱包中的每个密钥都是从不同的随机数独立生成的，密钥彼此之间没有任何关系，这种钱包也被称为 JBOK 钱包（Just a Bunch Of Keys）；</li> <li><strong>确定性钱包（Deterministic Wallet）</strong>：其中所有的密钥都是从一个主密钥派生出来的，这个主密钥就是种子（seed），在该类型的钱包中，所有的密钥之间都是相互关联的，如果有原始种子，就可以再次生成全部的密钥；在确定性钱包中，可以使用不同的密钥推导方式。目前最常用的推导方法是 树状结构，也称为 <strong>分层确定性钱包</strong> 或 <strong>HD 钱包</strong>；</li></ol> <p>我们文章的目的就是生成 <strong>HD 钱包</strong>，<strong>HD 钱包</strong> 可以允许用户在不安全的服务器上使用，或者在每笔交易中使用不同的公钥。</p> <p>涉及到钱包的一些常用标准规范有：</p> <ul><li><a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" target="_blank" rel="noopener noreferrer">BIP-39<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: 助记词</li> <li><a href="https://github.com/bitcoin/bips/blob/master/bip-0033.mediawiki" target="_blank" rel="noopener noreferrer">BIP-32<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：HD 钱包</li> <li><a href="https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki" target="_blank" rel="noopener noreferrer">BIP-43<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：多用途 HD 钱包结构</li> <li><a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" target="_blank" rel="noopener noreferrer">BIP-44<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：多币种和多账户钱包</li></ul> <p>要生成钱包私钥，我们需要有个种子(seed)，而我们这里是通过助记词来生成的，下面我们就先了解一下如何基于 <strong>BIP-39</strong> 规范来生成助记词和种子(seed)。</p> <h3 id="关于-bip-39"><a href="#关于-bip-39" class="header-anchor">#</a> 关于 BIP-39</h3> <p>BIP-39 规范主要描述了基于助记词（一组便于记忆的单词）来生成确定性钱包的算法和过程。</p> <p>该规范中主要由两部分构成：</p> <ol><li>如何生成助记词；</li> <li>如何将生成的助记词转化成一个二进制种子；</li></ol> <p>下面就先分别介绍这两个部分来看看如何生成确定性钱包。</p> <blockquote><p>后面涉及到一些示例代码都是采用的 python-mnemonic 库。</p></blockquote> <h3 id="生成助记词"><a href="#生成助记词" class="header-anchor">#</a> 生成助记词</h3> <p>生成助记词的算法过程如下图：</p> <p><img src="https://stevenocean.github.io/2018/09/23/generate-hd-wallet-by-bip39/generate-mnemonic-words.jpg" alt=""></p> <p>具体过程如下：</p> <ol><li>创建一个 128 到 256 位（步长 32 位）的随机序列（熵）；</li></ol> <blockquote><p>随机序列的长度称为 熵长，熵长按照步长 32 位，主要有几种分别为 [128, 160, 192, 224, 256]，我们示例图中是 128 位；</p></blockquote> <ol start="2"><li>对上一步生成的随机序列进行 SHA256 生成 Hash 值，并取出该 Hash 值的前 N 位（熵长/32，如：128 位，则 N = 4）作为随机序列的校验和（Checksum）；</li> <li>将 Checksum 添加至第一步生成的随机序列的尾部，此时对于图中示例加上 Checksum 之后为 128 + 4 = 132 位的随机序列；</li> <li>将上一步的随机序列按照 11 位一段进行分隔(split)，这样对于 128 位熵长的序列就会生成 12 段（132/11=12）；</li> <li>此时将每个包含 11 位部分的值与一个预定义的 2048 个单词的词典进行对应；</li> <li>按照切割顺序生成了最终的单词组就是助记词；</li></ol> <p>可以看到不同熵长对应的 Checksum 的长度，最终生成的助记词的长度不同，具体如下表：</p> <table><thead><tr><th>Entropy(bits)</th> <th>Checksum(bits)</th> <th>Entropy+Checksum(bits)</th> <th>Mnemonic length(words)</th></tr></thead> <tbody><tr><td>128</td> <td>4</td> <td>132</td> <td>12</td></tr> <tr><td>160</td> <td>5</td> <td>165</td> <td>15</td></tr> <tr><td>192</td> <td>6</td> <td>198</td> <td>18</td></tr> <tr><td>224</td> <td>7</td> <td>231</td> <td>21</td></tr> <tr><td>256</td> <td>8</td> <td>264</td> <td>24</td></tr></tbody></table> <blockquote><p>上面第 5 步涉及到单词表，理想的单词表应该满足智能选词、避免相似单词、排序单词表等特点，目前支持了多种<a href="https://github.com/bitcoin/bips/tree/master/bip-0039" target="_blank" rel="noopener noreferrer">不同国家的单词表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <p>如下示例代码基于 128 位强度的熵长生成了 12 个助记词：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> mnemonic <span class="token keyword">import</span> Mnemonic
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> m <span class="token operator">=</span> Mnemonic<span class="token punctuation">(</span><span class="token string">'english'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> words <span class="token operator">=</span> m<span class="token punctuation">.</span>generate<span class="token punctuation">(</span>strength<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> words
<span class="token string">u'olympic hard body window sibling used only mimic put sad ability bone'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="从助记词生成种子"><a href="#从助记词生成种子" class="header-anchor">#</a> 从助记词生成种子</h3> <p>助记词生成之后我们可以通过密钥生成函数 <strong>PBKDF2</strong> 算法来生成种子。</p> <p><strong>PBKDF2</strong> 需要提供两个参数：助记词和盐（salt）。其中 salt 的目的就是增加破解难度，而在 BIP-39 中，我们可以引入密码（passphrase）来作为保护种子的附加安全因素。</p> <blockquote><p>PBKDF2 is part of RSA Laboratories’ Public-Key Cryptography Standards (PKCS) series, specifically PKCS #5 v2.0, also published as Internet Engineering Task Force’s RFC 2898.</p></blockquote> <p>接着上面的助记词生成之后，如下图为生成 seed 的算法过程：</p> <p><img src="https://stevenocean.github.io/2018/09/23/generate-hd-wallet-by-bip39/generate-seed.jpg" alt=""></p> <ol start="7"><li>PBKDF2 的第一个参数是上面生成的助记词；</li> <li>PBKDF2 的第二个参数就是 salt，一般有字符串和可选的用户提供的密码字符串连接组成；</li> <li>PBKDF2 使用 HMAC-SHA512 算法，使用了 2048 次 Hash 之后产生一个 512 位的值作为种子；</li></ol> <p>如下示例代码为基于上面示例中生成的助记词来生成种子：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> seed <span class="token operator">=</span> Mnemonic<span class="token punctuation">.</span>to_seed<span class="token punctuation">(</span>words<span class="token punctuation">,</span> <span class="token string">&quot;hellobtc&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> seed
<span class="token string">&quot;\xb8\x94\xc79\xc6v\x07VY:\xfd\xb9J\x1d)\xffu3\x0c\x1d'\xd1F\xed\xe5c{R\xb9M\xdbu+\xdc\xc3\xb7\xc34\xe0\x81\xca\x97\x98W\xcf\xab\xa6\xa4c\xf3\xc9\x1d\xc0\xee\xd2\xa2{\xdaX+\x82\x14R\xfa&quot;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> base58<span class="token punctuation">.</span>b58encode<span class="token punctuation">(</span>seed<span class="token punctuation">)</span>
<span class="token string">'4h3QDYvyXEZRFeoCztcMybKH4aXkysTEmNqyDG2ZUyLTGvGwWUxXcEefCEB5JYjE8zuh2MSmLKsz9e8SQDpmzhuB'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> base58<span class="token punctuation">.</span>b58encode_check<span class="token punctuation">(</span>seed<span class="token punctuation">)</span>
<span class="token string">'R9cTcYjTpLGZEKquHyv5MzyfQAEYyRzAFTd9dxqNhKqKCCKsxmwcy27qetTbK8zEZDzLSLf7AjF9L9cuWY6bZ4UGzZ3GQ'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h1 id="从种子开始生成-hd-钱包"><a href="#从种子开始生成-hd-钱包" class="header-anchor">#</a> 从种子开始生成 HD 钱包</h1> <p>下面就将上面生成的种子作为 HD 钱包的根种子（root seed），任何 HD 钱包的根种子都可以重新创造整个 HD 钱包。</p> <p><img src="https://stevenocean.github.io/2018/09/23/generate-hd-wallet-by-bip39/generate-hd-master-key.jpg" alt=""></p> <p>将 root seed 输入到 HMAC-SHA512 算法中可以得到一个 512 位的 Hash，该 Hash 的左边 256 位作为 主私钥 m（Master Private Key），右边 256 位作为 主链码（Master Chain Code）。之后的 主公钥 M（Master Public Key，264 bits）可以通过 主私钥 m 生成。</p> <h3 id="子密钥衍生函数-child-key-derivation-ckd"><a href="#子密钥衍生函数-child-key-derivation-ckd" class="header-anchor">#</a> 子密钥衍生函数(Child Key Derivation, CKD)</h3> <p>如上所述，给定 Parent extended key 以及一个索引号(index)，就可以生成相应的 child extended key。</p> <p>各个子层级的密钥生成规则如下图：</p> <p><img src="https://stevenocean.github.io/2018/09/23/generate-hd-wallet-by-bip39/hd-key-derivation-bip32.jpg" alt=""></p> <p>从上图可以看到，HD 的密钥生成如下几个参数：</p> <ul><li><em><strong>Parent Private Key</strong></em> 或 <em><strong>Parent Public Key</strong></em>；（均为未压缩的 256 bits 的 ECDSA 密钥）；</li> <li>256 bits 的 <em><strong>Parent Chain Code</strong></em>；</li> <li>32-bit 整型的 <em><strong>index number</strong></em>（索引号）；</li></ul> <blockquote><p>另外，上面的过程是可以递归下去的，图中的 <em><strong>Child Private Key</strong></em> 可以作为其下一层级的 <em><strong>Parent Private Key</strong></em>。</p></blockquote> <p>通过将 (Parent Publick Key, Parent Chain Code, Index Number) 输入至 HMAC-SHA512 算法中，我们就可以生成其子密钥，并且我们可以通过调整 Index Number 来生成同一层级的多个子密钥。</p> <h2 id="关于扩展密钥-extended-key"><a href="#关于扩展密钥-extended-key" class="header-anchor">#</a> 关于扩展密钥(extended key)</h2> <p>因为这个密钥衍生函数是单向的，所有 子密钥 都是不能够被用来推导出它们的 父密钥 的，也不能推导出同层级的 姊妹密钥 的，只有 父密钥 和 父链码（又是由 Parent 的 Parent 层级的 密钥 和 链码 生成） 可以推导出所有的 子密钥 和 子链码，后续也就可以生成相应的 子公钥 以及地址，并且用于对交易进行签名。</p> <p>将 密钥 Key 和 Chain Code 结合起来称为 <strong>扩展密钥（extended key）</strong>，可以通过 <strong>扩展密钥</strong> 来生成自其而下的所有分支。</p> <p><strong>扩展密钥</strong> 中提供的密钥可以为 私钥 或者 公钥，和 链码 结合起来分别称为 <strong>扩展私钥（extended private key）</strong> 和 <strong>扩展公钥（extended public key）</strong>，并且分别记为 (k, c) 和 (K, c)，其中公钥 K = point(k)。</p> <p>我们可以从 <strong>扩展私钥</strong> 推导出 <strong>扩展公钥</strong>，而反之则不可以，因此对于某些交易场景（如电商），可以为每笔交易生成一个新的公钥和地址来收款，而扩展私钥可以被存储在纸质钱包或者硬件钱包中，用于安全的离线签署交易。可以看到 <strong>扩展公钥</strong> 的安全性相对高一些，下图为通过 扩展 父公钥 来衍生 子私钥进而生成子公钥 的传递机制：</p> <p><img src="https://stevenocean.github.io/2018/09/23/generate-hd-wallet-by-bip39/extend-pubkey.jpg" alt=""></p> <blockquote><p><strong>扩展密钥</strong> 也通过 Base58Check 进行编码，<strong>扩展私钥</strong> 和 <strong>扩展公钥</strong> 的编码分别以 <strong>xprv</strong> 和 <strong>xpub</strong> 作为前缀。</p></blockquote> <h2 id="硬化衍生子密钥又是什么鬼"><a href="#硬化衍生子密钥又是什么鬼" class="header-anchor">#</a> 硬化衍生子密钥又是什么鬼？</h2> <p>上面的 <strong>扩展密钥</strong>（尤其是 <strong>扩展公钥</strong>） 生成的钱包应该够安全的了，但是设计这一套钱包密钥生成算法的工程师觉得还不够：即使暴露了 <strong>扩展公钥</strong>，也就是暴露了 <strong>子公钥</strong> 和 <strong>Chain Code</strong>，但是如果哪天不小心，你那个 <strong>子私钥</strong> 也不小心泄露了，那么以这个 子密钥和 Chain Code 作为根的那棵树上挂着的所有的密钥也都能够被推导出来了，这TM太危险了（是的，你要是把你的 root seed 泄露了，估计够你哭三天三夜的~没币除外）。</p> <p>然后 HD 钱包又提出来一种叫做 <strong>硬化衍生(hardened derivation)</strong> 的衍生函数，从上面 <strong>扩展公钥</strong> 生成的图中可以看到 子密钥 和 子链码 都是由 父公钥 和 父链码 通过 HMAC-SHA512 生成的（也都是相对比较容易“曝光”的），而 <strong>硬化衍生</strong> 函数将 父公钥 换成 父私钥 来推导出 子密钥 和 子链码，如下图：</p> <p><img src="https://stevenocean.github.io/2018/09/23/generate-hd-wallet-by-bip39/hardened_derivation.jpg" alt=""></p> <ul><li>图上标识了 索引号码 根据 正常衍生 和 硬化衍生 不同，索引的范围不同，对于正常衍生的索引号范围为 [0x0, 0x7FFFFFFF]，而硬化衍生的索引号范围为 [0x80000000, 0xFFFFFFFF]；</li> <li>硬化衍生的索引号太长，一般为了便于阅读，都是会将索引号右上角加上撇号，譬如：0x80000000 记为 0’，0x80000001 记为 1’，以此类推；</li></ul> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>针对 <strong>扩展密钥</strong> 的学习，可以看到有三种生成规则，分别如下：</p> <ol><li>Private parent key -&gt; private child key</li></ol> <p>即，从 父扩展私钥 和 父链码 计算生成 子扩展私钥 和 子链码。用公式表示就是：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>CKDpriv((kpar, cpar), i) → (ki, ci)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>Public parent key -&gt; public child key</li></ol> <p>即，从 父扩展公钥 和 父链码 计算生成 子扩展公钥 和 子链码。公式表示如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>CKDpub((Kpar, cpar), i) → (Ki, ci)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>Private parent key -&gt; public child key</li></ol> <p>即，从 父扩展私钥 和 父链码 计算生成 子扩展公钥 和 子链码。公式表示如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>N((k, c)) → (K, c)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下面是根据自己理解整理的 HD Wallet 的分层密钥生成结构图如下：</p> <p><img src="https://stevenocean.github.io/2018/09/23/generate-hd-wallet-by-bip39/generate-hd-wallet.jpg" alt=""></p> <h1 id="参考来源"><a href="#参考来源" class="header-anchor">#</a> 参考来源</h1> <ul><li><p><strong><a href="https://github.com/bitcoinbook/bitcoinbook" target="_blank" rel="noopener noreferrer">Master Bitcoin 2nd<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></li> <li><p><strong><a href="https://bitcoin.org/en/developer-guide" target="_blank" rel="noopener noreferrer">Bitcoin developer guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></li> <li><p><strong><a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" target="_blank" rel="noopener noreferrer">BIP-39 Mnemonic code for generating deterministic keys<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></li> <li><p><strong><a href="https://github.com/bitcoin/bips/blob/master/bip-0033.mediawiki" target="_blank" rel="noopener noreferrer">BIP-32 Hierarchical Deterministic Wallets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></li> <li><p><strong><a href="https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki" target="_blank" rel="noopener noreferrer">BIP-43 Purpose Field for Deterministic Wallets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></li> <li><p><strong><a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" target="_blank" rel="noopener noreferrer">BIP-44 Multi-Account Hierarchy for Deterministic Wallets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></li> <li><p><strong><a href="https://en.wikipedia.org/wiki/PBKDF2" target="_blank" rel="noopener noreferrer">PBKDF2 - Password-Based Key Derivation Function 2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></li> <li><p><strong><a href="https://en.wikipedia.org/wiki/HMAC" target="_blank" rel="noopener noreferrer">HMAC - hash-based message authentication code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></li> <li><p><strong><a href="https://tools.ietf.org/html/rfc4231" target="_blank" rel="noopener noreferrer">Identifiers and Test Vectors for HMAC-SHA-224, HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></li></ul> <blockquote><p>Post author:** Steven Hu</p> <p><strong>Post link:</strong> <a href="http://stevenocean.github.io/2018/09/23/generate-hd-wallet-by-bip39.html" title="基于 BIP-32 和 BIP-39 规范生成 HD 钱包（分层确定性钱包）" target="_blank" rel="noopener noreferrer">基于 BIP-32 和 BIP-39 规范生成 HD 钱包（分层确定性钱包） | 未来边缘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Copyright Notice:</strong> All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">CC BY-NC-SA 4.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> unless stating additionally.</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/baryon/MasterBitcoinSV/edit/master/src/ch05a.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/MasterBitcoinSV/ch05.html" class="prev">
        第5章 钱包
      </a></span> <span class="next"><a href="/MasterBitcoinSV/ch06.html">
        第6章 交易
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/MasterBitcoinSV/assets/js/app.1cc508ac.js" defer></script><script src="/MasterBitcoinSV/assets/js/3.37227c69.js" defer></script><script src="/MasterBitcoinSV/assets/js/26.7276f704.js" defer></script>
  </body>
</html>
